{% extends "admin/base_site.html" %}
{% load static %}
{% load admin_extras %}

{% block title %}Multi-Language Dashboard{% endblock %}

{% block extrahead %}
<style>
    .language-tabs {
        display: flex;
        border-bottom: 2px solid #ddd;
        margin-bottom: 20px;
    }
    
    .language-tab {
        padding: 12px 24px;
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-bottom: none;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 2px;
    }
    
    .language-tab.active {
        background: #007cba;
        color: white;
        border-color: #007cba;
    }
    
    .language-tab:hover {
        background: #e9ecef;
    }
    
    .language-tab.active:hover {
        background: #005a87;
    }
    
    .language-content {
        display: none;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 0 0 8px 8px;
    }
    
    .language-content.active {
        display: block;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-left: 4px solid #007cba;
    }
    
    .stat-card h3 {
        margin: 0 0 10px 0;
        color: #333;
        font-size: 1.1em;
    }
    
    .stat-value {
        font-size: 2em;
        font-weight: bold;
        color: #007cba;
    }
    
    .today-song-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        border: 2px solid #007cba;
    }
    
    .song-actions {
        margin-top: 15px;
    }
    
    .btn-custom {
        background: #007cba;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
    }
    
    .btn-custom:hover {
        background: #005a87;
    }
    
    .tamil-theme { border-left-color: #B026FF; }
    .english-theme { border-left-color: #1E90FF; }
    .hindi-theme { border-left-color: #FF6B35; }
</style>
{% endblock %}

{% block content %}
<h1>Multi-Language Game Dashboard</h1>

<div class="language-tabs">
    {% for lang_code, lang_name in languages %}
    <div class="language-tab {% if forloop.first %}active{% endif %}" 
         data-language="{{ lang_code }}" 
         onclick="switchLanguage('{{ lang_code }}')">
        {% if lang_code == 'tamil' %}
            üéµ SPOT-ify the Paatu
        {% elif lang_code == 'english' %}
            üéß SPOT-ify the Song
        {% elif lang_code == 'hindi' %}
            üé§ SPOT-ify the Gaana
        {% endif %}
        <small style="display: block; font-size: 0.8em; opacity: 0.8;">{{ lang_name }}</small>
    </div>
    {% endfor %}
</div>

{% for lang_code, lang_name in languages %}
<div class="language-content {% if forloop.first %}active{% endif %}" id="content-{{ lang_code }}">
    <div class="stats-grid">
        <div class="stat-card {{ lang_code }}-theme">
            <h3>Today's Song</h3>
            <div class="stat-value" id="today-song-{{ lang_code }}">
                {% if today_songs|lookup:lang_code %}
                    ‚úÖ Set
                {% else %}
                    ‚ùå Not Set
                {% endif %}
            </div>
        </div>
        
        <div class="stat-card {{ lang_code }}-theme">
            <h3>Total Songs</h3>
            <div class="stat-value" id="total-songs-{{ lang_code }}">-</div>
        </div>
        
        <div class="stat-card {{ lang_code }}-theme">
            <h3>Today's Players</h3>
            <div class="stat-value" id="today-players-{{ lang_code }}">-</div>
        </div>
        
        <div class="stat-card {{ lang_code }}-theme">
            <h3>Used Songs</h3>
            <div class="stat-value" id="used-songs-{{ lang_code }}">-</div>
        </div>
    </div>
    
    <div class="today-song-card">
        <h3>Today's {{ lang_name }} Song ({{ today }})</h3>
        {% with today_song=today_songs|lookup:lang_code %}
        {% if today_song %}
            <p><strong>{{ today_song.title }}</strong> by {{ today_song.artist }}</p>
            <p>From: {{ today_song.movie }}</p>
            <div class="song-actions">
                <button class="btn-custom" onclick="changeDailySong('{{ lang_code }}')">Change Song</button>
                <a href="{% url 'admin:game_song_change' today_song.id %}" class="btn-custom">Edit Song</a>
            </div>
        {% else %}
            <p>No song set for today. Please set a song for {{ lang_name }}.</p>
            <div class="song-actions">
                <button class="btn-custom" onclick="setDailySong('{{ lang_code }}')">Set Today's Song</button>
            </div>
        {% endif %}
        {% endwith %}
    </div>
</div>
{% endfor %}

<script>
function switchLanguage(language) {
    // Update tabs
    document.querySelectorAll('.language-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelector(`[data-language="${language}"]`).classList.add('active');
    
    // Update content
    document.querySelectorAll('.language-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(`content-${language}`).classList.add('active');
    
    // Load stats for this language
    loadLanguageStats(language);
}

function loadLanguageStats(language) {
    fetch(`/admin/language-stats/${language}/`)
        .then(response => response.json())
        .then(data => {
            document.getElementById(`total-songs-${language}`).textContent = data.total_songs || 0;
            document.getElementById(`used-songs-${language}`).textContent = data.used_songs || 0;
            document.getElementById(`today-players-${language}`).textContent = data.today_players || 0;
        })
        .catch(error => console.error('Error loading stats:', error));
}

function setDailySong(language) {
    // This would open a modal or redirect to song selection
    alert(`Setting daily song for ${language}. This feature will be implemented.`);
}

function changeDailySong(language) {
    // This would open a modal or redirect to song selection
    alert(`Changing daily song for ${language}. This feature will be implemented.`);
}

// Load stats for the first language on page load
document.addEventListener('DOMContentLoaded', function() {
    loadLanguageStats('tamil');
});
</script>

{% endblock %}
